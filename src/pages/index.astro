---
import BaseLayout from "../layouts/BaseLayout.astro";
import LiquidTransition from "../components/LiquidTransition.astro";
import BeerCard from "../components/BeerCard.astro";
import MistParticlesBeer from "../components/MistParticlesBeer.astro";
import MistParticlesFireflies from "../components/MistParticlesFireflies.astro";

const beers = [
  {
    name: "Dark Lodge IPA",
    type: "India Pale Ale",
    abv: 6.8,
    ibu: 65,
    description:
      "A secret blend of citrus and pine with a dark, smoky finish that lingers like whispers in the night.",
    color: "#D2691E",
    available: true,
  },
  {
    name: "Midnight Porter",
    type: "Robust Porter",
    abv: 5.4,
    ibu: 35,
    description:
      "Rich chocolate and coffee notes with a smooth texture. Perfect for contemplating life's mysteries.",
    color: "#2F1B14",
    available: true,
  },
  {
    name: "Copper Log Lager",
    type: "Vienna Lager",
    abv: 4.8,
    ibu: 22,
    description:
      "Crisp and clean with a subtle malty sweetness and a hint of the forest floor after rain.",
    color: "#B87333",
    available: true,
  },
  {
    name: "Red Room Ale",
    type: "American Red Ale",
    abv: 5.9,
    ibu: 40,
    description:
      "A bold red ale with caramel backbone and curious floral notes that dance on the palate.",
    color: "#A0522D",
    available: false,
  },
  {
    name: "Twin Peaks Wheat",
    type: "Hefeweizen",
    abv: 4.2,
    ibu: 15,
    description:
      "Light and cloudy with notes of banana and clove, as enigmatic as morning mist on the mountains.",
    color: "#F4A460",
    available: true,
  },
  {
    name: "Lodge Stout",
    type: "Imperial Stout",
    abv: 8.2,
    ibu: 55,
    description:
      "Deep, dark, and complex with notes of vanilla, oak, and whispers of ancient secrets.",
    color: "#1C1C1C",
    available: true,
  },
];

const events = [
  {
    date: "July 15",
    title: "Mystery Beer Release",
    description: "Unveiling our latest creation - a beer shrouded in mystery",
  },
  {
    date: "July 22",
    title: "Trivia Night",
    description: "Test your knowledge of mysteries, both solved and unsolved",
  },
  {
    date: "July 29",
    title: "Live Jazz Evening",
    description:
      "Sultry sounds to accompany your evening libations with friends",
  },
];
---

<BaseLayout
  title="Black Lodge Brews - Premium Craft Brewery"
  description="Enter the mysterious world of Black Lodge Brews, where every sip tells a story and every brew holds secrets waiting to be discovered."
>
  <!-- Advanced Liquid Clustering Effects -->
  <svg width="0" height="0" style="position: absolute;">
    <defs>
      <!-- Liquid clustering filter -->
      <filter id="liquid-cluster" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="12" result="blur"/>
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 25 -12" result="threshold"/>
        <feFlood flood-color="#FFA000" flood-opacity="0.8" result="color"/>
        <feComposite in="color" in2="threshold" operator="in" result="liquid"/>
        <feGaussianBlur in="liquid" stdDeviation="8" result="liquid-blur"/>
        <feComposite in="SourceGraphic" in2="liquid-blur" operator="over"/>
      </filter>
      
      <!-- Enhanced gooey morphing -->
      <filter id="enhanced-gooey" x="-30%" y="-30%" width="160%" height="160%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"/>
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -8" result="matrix"/>
        <feComposite in="SourceGraphic" in2="matrix" operator="over"/>
      </filter>
      
      <!-- Liquid drop effect -->
      <filter id="liquid-drop" x="-40%" y="-40%" width="180%" height="180%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 15 -6" result="matrix"/>
        <feFlood flood-color="#FFD54F" flood-opacity="0.6" result="highlight"/>
        <feComposite in="highlight" in2="matrix" operator="in" result="liquid-highlight"/>
        <feComposite in="SourceGraphic" in2="liquid-highlight" operator="over"/>
      </filter>
    </defs>
  </svg>

  <LiquidTransition direction="up" duration={0.8} color="#FFA000" />

  <!-- Hero Section -->
  <section class="hero section filling-section" id="lodge">
    <div class="hero-content">
      <div class="hero-text">
        <h1 class="hero-title">Black<br /> Lodge<br /> Brews</h1>
        <p class="hero-subtitle">Histories poured<br>into every glass</p>
      </div>
    </div>
    <div class="beer-level-container">
      <div class="beer-level">
        <div class="beer-liquid"></div>
        <div class="beer-foam"></div>
      </div>
    </div>
    <MistParticlesBeer
      particleCount={40}
      color="#FFFFFF"
      size={3}
      speed={1.5}
      opacity={0.5}
    />
  </section>

  <!-- Tap List Section -->
  <section id="taps" class="section taps-section">
    <div class="container">
      <h2 class="section-title">Our Woodsy Taps</h2>
      <p class="section-subtitle">
        Each brew tells a story, each sip reveals a secret
      </p>

      <div class="beers-grid">
        {beers.map((beer) => <BeerCard {...beer} />)}
      </div>
    </div>
  </section>

  <!-- Our Story Section -->
  <section id="story" class="section story-section">
    <div class="parallax-bg story-bg" data-speed="0.5"></div>
    <div class="container">
      <div class="story-content">
        <div class="story-text">
          <h2>The Legend of Black Lodge</h2>
          <p>
            Deep in the heart of the Pacific Northwest, where ancient forests
            whisper secrets and mist dances through towering pines, lies the
            enigmatic Black Lodge Brewery. Founded in 2023 by a group of
            passionate brewers who believe that the best ales are born from
            mystery and crafted with intention.
          </p>

          <p>
            Our brewing process is as much art as it is science. We source our
            ingredients from local farms that have been tended by generations of
            families who understand the land's perplexities. Each batch is carefully
            crafted in small quantities, ensuring that every glass carries the
            essence of our mystic heritage.
          </p>

          <p>
            The lodge itself stands as a testament to craftsmanship.
            Built from reclaimed timber and stone, it houses our
            state-of-the-art brewing equipment alongside relics and curiosities
            collected from around the world. Every corner tells a story, every
            shadow holds a secret.
          </p>
        </div>
      </div>
    </div>
    <MistParticlesFireflies
      particleCount={10}
      color="#FFA000"
      size={1}
      speed={0.05}
      opacity={0.3}
    />
  </section>

  <!-- Taproom Section -->
  <section id="taproom" class="section taproom-section">
    <div class="container">
      <h2 class="section-title">The Taproom Experience</h2>
      <p class="section-subtitle">
        Step into a world where every detail matters
      </p>

      <div class="taproom-content">
        <div class="taproom-description">
          <h3>Immerse Yourself</h3>
          <div class="liquid-cluster-container">
            <div class="taproom-features">
              <div class="feature liquid-card">
                <h4>üç∫ Fresh Pours</h4>
                <p>
                  All our beers are served at the perfect temperature from our
                  custom tap system
                </p>
              </div>
              <div class="feature liquid-card">
                <h4>üéµ Live Music</h4>
                <p>
                  Regular performances featuring local jazz groups, folk singers,
                  and ambient artists
                </p>
              </div>
              <div class="feature liquid-card">
                <h4>ü•® Artisan Bites</h4>
                <p>
                  Carefully selected food pairings, sweet and savory, that
                  complement our unique brews
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="events-calendar">
          <h3>Upcoming Events</h3>
          <div class="liquid-drop-container">
            <div class="events-list">
              {
                events.map((event) => (
                  <div class="event-item liquid-drop-card">
                    <div class="event-date">{event.date}</div>
                    <div class="event-details">
                      <h4>{event.title}</h4>
                      <p>{event.description}</p>
                    </div>
                  </div>
                ))
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact" class="section contact-section">
    <div class="parallax-bg contact-bg" data-speed="0.3"></div>
    <div class="container">
      <h2 class="section-title">Find Your Way to the Lodge</h2>

      <div class="contact-content">
        <div class="contact-info">
          <div class="contact-item">
            <h3>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="#FFD54F"
                class="contact-icon"
                ><path
                  fill-rule="evenodd"
                  d="m11.54 22.351.07.04.028.016a.76.76 0 0 0 .723 0l.028-.015.071-.041a16.975 16.975 0 0 0 1.144-.742 19.58 19.58 0 0 0 2.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 0 0-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 0 0 2.682 2.282 16.975 16.975 0 0 0 1.145.742ZM12 13.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                  clip-rule="evenodd"></path></svg
              > Location
            </h3>
            <p>123 Brewery Lane<br />Portland, OR 97210</p>
          </div>

          <div class="contact-item">
            <h3>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="#FFD54F"
                class="contact-icon"
                ><path
                  d="M10.5 18.75a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z"
                ></path><path
                  fill-rule="evenodd"
                  d="M8.625.75A3.375 3.375 0 0 0 5.25 4.125v15.75a3.375 3.375 0 0 0 3.375 3.375h6.75a3.375 3.375 0 0 0 3.375-3.375V4.125A3.375 3.375 0 0 0 15.375.75h-6.75ZM7.5 4.125C7.5 3.504 8.004 3 8.625 3h6.75c.621 0 1.125.504 1.125 1.125v15.75c0 .621-.504 1.125-1.125 1.125h-6.75A1.125 1.125 0 0 1 7.5 19.875V4.125Z"
                  clip-rule="evenodd"></path></svg
              > Phone
            </h3>
            <p>(503) 555-BREW</p>
          </div>

          <div class="contact-item">
            <h3>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="#FFD54F"
                class="contact-icon"
                ><path
                  fill-rule="evenodd"
                  d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z"
                  clip-rule="evenodd"></path></svg
              > Hours
            </h3>
            <p>
              Monday - Thursday: 4pm - 10pm<br />
              Friday - Saturday: 2pm - 12am<br />
              Sunday: 2pm - 9pm
            </p>
          </div>
        </div>

        <div class="map-container">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d11179.794472859286!2d-122.69833!3d45.52306!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x549509fc2302c4ad%3A0x23b6b67b7be6d6d1!2sPearl%20District%2C%20Portland%2C%20OR!5e0!3m2!1sen!2sus!4v1700000000000!5m2!1sen!2sus"
            width="100%"
            height="400"
            style="border:0; border-radius: 16px;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            title="Black Lodge Brews Location - Portland, OR"
          >
          </iframe>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style lang="scss">
  @import "../styles/global.scss";
  @import "../styles/home-page";
  
  // Custom particle canvas sizing - extend both up and down for maximum coverage
  .hero .mist-container-beer {
    height: 150%;
    top: -25%;
  }
</style>

<script>
  // GSAP ScrollTrigger Parallax Implementation
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  // Register ScrollTrigger plugin
  gsap.registerPlugin(ScrollTrigger);

  // Liquid card animation on scroll
  class LiquidCardAnimator {
    animatedCards;
    constructor() {
      this.animatedCards = new Set();
      this.init();
    }

    init() {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting && !this.animatedCards.has(entry.target)) {
              // Add staggered delay for multiple cards
              const parent = entry.target.parentElement;
              const delay = parent
                ? Array.from(parent.children).indexOf(entry.target) * 200
                : 0;

              setTimeout(() => {
                entry.target.classList.add("liquid-animate");
                this.animatedCards.add(entry.target);
              }, delay);
            }
          });
        },
        {
          threshold: 0.2,
          rootMargin: "0px 0px -30px 0px",
        }
      );

      // Observe all liquid cards
      document.querySelectorAll(".liquid-card, .liquid-drop-card").forEach((card) => {
        observer.observe(card);
      });
    }
  }

  // Enhanced liquid interaction effects
  class LiquidInteractionEffects {
    constructor() {
      this.setupHoverEffects();
      this.setupProximityEffects();
    }
    
    setupHoverEffects() {
      // Add enhanced hover effects for liquid cards
      document.querySelectorAll('.liquid-card, .liquid-drop-card').forEach(card => {
        card.addEventListener('mouseenter', () => {
          // Add ripple effect on hover
          const ripple = document.createElement('div');
          ripple.className = 'liquid-ripple';
          card.appendChild(ripple);
          
          setTimeout(() => {
            ripple.remove();
          }, 1000);
        });
      });
    }
    
    setupProximityEffects() {
      // Create proximity-based liquid clustering
      const containers = document.querySelectorAll('.liquid-cluster-container, .liquid-drop-container');
      
      containers.forEach(container => {
        const cards = container.querySelectorAll('.liquid-card, .liquid-drop-card');
        
        cards.forEach((card, index) => {
          card.addEventListener('mouseenter', () => {
            // Enhance nearby cards when one is hovered
            cards.forEach((otherCard, otherIndex) => {
              if (Math.abs(index - otherIndex) <= 1 && card !== otherCard) {
                otherCard.style.transform = 'scale(1.02) translateY(-2px)';
                otherCard.style.filter = 'brightness(1.1)';
              }
            });
          });
          
          card.addEventListener('mouseleave', () => {
            // Reset nearby cards
            cards.forEach(otherCard => {
              if (card !== otherCard) {
                otherCard.style.transform = '';
                otherCard.style.filter = '';
              }
            });
          });
        });
      });
    }
  }

  // Initialize when DOM is loaded
  document.addEventListener("DOMContentLoaded", () => {
    new LiquidCardAnimator();
    new LiquidInteractionEffects();
  });

  // Re-initialize on Astro page transitions
  document.addEventListener("astro:page-load", () => {
    new LiquidCardAnimator();
    new LiquidInteractionEffects();
  });

  // Beer level filling animation
  class SectionFillAnimation {
    constructor() {
      this.fillingSection = document.querySelector(".filling-section");
      this.isAnimating = false;

      if (this.fillingSection) {
        // Start filling animation after 2 seconds
        setTimeout(() => {
          this.startFilling();
        }, 2000);
      }
    }

    startFilling() {
      if (this.isAnimating) return;

      this.isAnimating = true;
      this.fillingSection.classList.add("filling");

      // Add filled class after animation completes
      setTimeout(() => {
        this.fillingSection.classList.add("filled");
      }, 4000);
    }
  }

  // Initialize section fill animation
  new SectionFillAnimation();

  // Professional parallax implementation
  class GSAPParallaxController {
    constructor() {
      this.initParallax();
    }

    initParallax() {
      // Wait for DOM to be fully loaded
      gsap.set('.parallax-bg', { transformOrigin: 'center center' });

      // Story section parallax
      gsap.to('.story-bg', {
        y: '-30%',
        ease: 'none',
        scrollTrigger: {
          trigger: '.story-section',
          start: 'top bottom',
          end: 'bottom top',
          scrub: 1, // Smooth scrubbing
          invalidateOnRefresh: true,
        }
      });

      // Contact section parallax with different speed
      gsap.to('.contact-bg', {
        y: '-20%',
        ease: 'none',
        scrollTrigger: {
          trigger: '.contact-section',
          start: 'top bottom',
          end: 'bottom top',
          scrub: 1.2, // Slightly different scrub for variation
          invalidateOnRefresh: true,
        }
      });

      // Refresh ScrollTrigger on window resize
      window.addEventListener('resize', () => {
        ScrollTrigger.refresh();
      });
    }
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    new GSAPParallaxController();
  });

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', () => {
    new GSAPParallaxController();
  });

</script>
